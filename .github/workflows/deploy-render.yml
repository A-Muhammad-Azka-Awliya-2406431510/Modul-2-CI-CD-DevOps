name: Deploy to Render

on:
  push:
    branches:
      - main
      - module-2-exercise
  workflow_dispatch:

jobs:
  deploy:
    name: Trigger Render deploy
    runs-on: ubuntu-22.04
    steps:
      - name: Trigger deploy hook
        env:
          RENDER_DEPLOY_HOOK_URL: ${{ secrets.RENDER_DEPLOY_HOOK_URL }}
        run: |
          if [ -z "$RENDER_DEPLOY_HOOK_URL" ]; then
            echo "Missing secret RENDER_DEPLOY_HOOK_URL."
            echo "Add it in GitHub repo settings: Secrets and variables > Actions."
            exit 1
          fi

          curl --fail --silent --show-error --request POST "$RENDER_DEPLOY_HOOK_URL"
          echo "Render deployment triggered successfully."
